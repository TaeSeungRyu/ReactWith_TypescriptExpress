<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<head>
	<script src = "https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>

<body>
	hello world
	<h1>Hello Express</h1>
	<button onClick="makeRoom()">방만들기</button>

	<button onClick="inRoom()">방들어가기</button>

	<button onClick="sendMsg()">메시지보내기</button>
</body>

</html>

<script>
	const ws = new WebSocket("ws://localhost:8001/wsocket")

	let id = '';  //웹소켓에서 사용될 아이디 값
	sessionStorage.setItem('id','admin')

	//방만들기
	function makeRoom() {
		let create = {  //전송 규격
			_id : id,
			kor : '1번방',
			password : '1234',
			create : 'create'
		}
		ws.send(JSON.stringify(create))  
	}

	//방 들어가기
	let roomId = '';
	let roomPwd = '';
	function inRoom() {
		$.ajax({
			url: '/data/getRoomList',	
			data: {},
			type: 'post',
			success: function (res) {
				console.log(res)
				// let join = {  //전송 규격
				// 	_room_id : '',
				// 	password : '1234',
				// 	join : 'join'
				// }		
				// ws.send(JSON.stringify(join))  				
			},
			error : function(err){
				console.log(err)
			}			
		})

	}
	
	//메지시 전송하기
	function sendMsg() {
		ws.send(`{"hello":"asdfasdf"}`) 
	}	

	function receiveMessage(event) {
		let object = JSON.parse(event.data);
		if(object.id){id = object.id}
	}

	ws.onmessage = receiveMessage	
</script>